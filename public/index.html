<!DOCTYPE html>
<html>
<head>
  <title>Hunger Games Simulator</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: Arial; background:#111; color:#eee; }
    button { margin:5px; padding:8px; }
    .taken { opacity:0.4; }
  </style>
</head>
<body>

<h1>Hunger Games Simulator</h1>

<div id="menu">
  <button onclick="showCreate()">Create Party</button>
  <button onclick="showJoin()">Join Party</button>
</div>

<div id="create" style="display:none">
  <input id="cname" placeholder="Party Name">
  <input id="cpass" placeholder="Password">
  <button onclick="createParty()">Create</button>
</div>

<div id="join" style="display:none">
  <div id="partyList"></div>
</div>

<div id="lobby" style="display:none">
  <h2>Lobby</h2>
  <p id="playerCount"></p>
  <div id="tributes"></div>
  <button id="startBtn" onclick="startGame()" style="display:none">START GAME</button>
</div>

<script>
const socket = io();
let currentParty = null;

function showCreate() {
  document.getElementById("create").style.display="block";
}
function showJoin() {
  socket.emit("getParties");
  document.getElementById("join").style.display="block";
}

function createParty() {
  socket.emit("createParty", {
    name: cname.value,
    password: cpass.value
  });
}

socket.on("partyList", parties => {
  const div = document.getElementById("partyList");
  div.innerHTML="";
  parties.forEach(p => {
    const b = document.createElement("button");
    b.textContent = `${p.name} (${p.players}/8)`;
    b.onclick = () => {
      const pass = prompt("Password?");
      socket.emit("joinParty", { partyId: p.id, password: pass });
    };
    div.appendChild(b);
  });
});

socket.on("partyUpdate", party => {
  currentParty = party;
  document.getElementById("menu").style.display="none";
  document.getElementById("create").style.display="none";
  document.getElementById("join").style.display="none";
  document.getElementById("lobby").style.display="block";

  document.getElementById("playerCount").textContent =
    `Players: ${Object.keys(party.players).length}/8`;

  const tribDiv = document.getElementById("tributes");
  tribDiv.innerHTML="";
  party.tributes.forEach(t => {
    const b = document.createElement("button");
    b.textContent = t.name;
    if (t.taken) b.className="taken";
    b.onclick = () => socket.emit("selectTribute", {
      partyId: party.id,
      tributeName: t.name
    });
    tribDiv.appendChild(b);
  });

  if (party.host === socket.id && !party.started) {
    document.getElementById("startBtn").style.display="block";
  }
});

function startGame() {
  socket.emit("startGame", currentParty.id);
}

socket.on("gameStarted", () => {
  alert("Game started!");
});
</script>

</body>
</html>
