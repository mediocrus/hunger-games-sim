<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Hunger Games Simulator</title>
<script src="/socket.io/socket.io.js"></script>
<style>
  body { font-family: Arial, sans-serif; background:#111; color:#eee; }
  button { margin: 5px; padding:6px 10px; }
  input { margin:5px; padding:5px; }

  .hidden { display:none; }

  #lobby, #partyRoom, #gameArea {
    border:1px solid #444;
    padding:10px;
    margin-top:10px;
  }

  .tribute-btn {
    background:#333;
    color:#eee;
  }
  .tribute-btn.taken {
    background:#666;
    color:#999;
    pointer-events:none;
  }

  #log {
    background:#000;
    border:1px solid #444;
    height:200px;
    overflow-y:auto;
    padding:5px;
    margin-top:10px;
    font-size:14px;
  }

  #chat {
    margin-top:10px;
  }
</style>
</head>
<body>

<h1>Hunger Games Simulator</h1>

<!-- ================= LOBBY ================= -->
<div id="lobby">
  <button onclick="showCreate()">Create Party</button>
  <button onclick="showJoin()">Join Party</button>

  <div id="createArea" class="hidden">
    <h3>Create Party</h3>
    <input id="createName" placeholder="Party Name">
    <input id="createPass" type="password" placeholder="Password">
    <button onclick="createParty()">Create</button>
  </div>

  <div id="joinArea" class="hidden">
    <h3>Join Party</h3>
    <div id="partyList"></div>
  </div>
</div>

<!-- ================= PARTY ROOM ================= -->
<div id="partyRoom" class="hidden">
  <h2 id="partyTitle"></h2>
  <p id="playerCount"></p>

  <h3>Tributes</h3>
  <div id="tributeList"></div>

  <button id="startBtn" class="hidden" onclick="startGame()">START GAME</button>
</div>

<!-- ================= GAME AREA ================= -->
<div id="gameArea" class="hidden">
  <h2 id="phaseInfo"></h2>

  <div id="log"></div>

  <div id="actionArea">
    <button onclick="sendMove()">Move</button>
    <button onclick="sendAttack()">Attack</button>
    <button onclick="endTurn()">End Turn</button>
  </div>

  <div id="chat">
    <input id="chatInput" placeholder="Spectator chat only">
    <button onclick="sendChat()">Send</button>
  </div>
</div>

<script>
const socket = io();

let currentPartyId = null;
let myTribute = null;
let isHost = false;

// ---------- UI helpers ----------
function showCreate() {
  document.getElementById("createArea").classList.remove("hidden");
  document.getElementById("joinArea").classList.add("hidden");
}

function showJoin() {
  document.getElementById("joinArea").classList.remove("hidden");
  document.getElementById("createArea").classList.add("hidden");
  socket.emit("requestPartyList");
}

// ---------- Party creation ----------
function createParty() {
  socket.emit("createParty", {
    partyName: createName.value,
    password: createPass.value
  });
}

// ---------- Join ----------
function joinParty(id) {
  const pass = prompt("Enter party password:");
  socket.emit("joinParty", { partyId:id, password:pass });
}

// ---------- Start ----------
function startGame() {
  socket.emit("startGame", { partyId: currentPartyId });
}

// ---------- Game actions ----------
function sendMove() {
  socket.emit("playerAction", { partyId:currentPartyId, action:"move", destination:0 });
}
function sendAttack() {
  socket.emit("playerAction", { partyId:currentPartyId, action:"attack", target:null });
}
function endTurn() {
  socket.emit("playerAction", { partyId:currentPartyId, action:"wait" });
}

// ---------- Socket events ----------
socket.on("partyList", parties => {
  const div = document.getElementById("partyList");
  div.innerHTML = "";
  parties.forEach(p => {
    const b = document.createElement("button");
    b.textContent = `${p.name} (${p.players}/8)`;
    b.onclick = () => joinParty(p.id);
    div.appendChild(b);
  });
});

socket.on("partyCreated", data => {
  currentPartyId = data.partyId;
  document.getElementById("lobby").classList.add("hidden");
  document.getElementById("partyRoom").classList.remove("hidden");
  document.getElementById("partyTitle").textContent = data.partyName;
});

socket.on("updateParty", party => {
  if (!party) return;

  currentPartyId = party.id;
  isHost = party.hostSocketId === socket.id;

  document.getElementById("playerCount").textContent =
    `Players: ${Object.values(party.players).filter(p=>p.tributeName).length}/8`;

  const tDiv = document.getElementById("tributeList");
  tDiv.innerHTML = "";

  Object.values(party.tributes).forEach(t => {
    const btn = document.createElement("button");
    btn.textContent = t.name;
    btn.className = "tribute-btn";
    if (!t.isAI) btn.classList.add("taken");
    btn.onclick = () => {
      myTribute = t.name;
      socket.emit("selectTribute",{ partyId:party.id, tributeName:t.name });
    };
    tDiv.appendChild(btn);
  });

  document.getElementById("startBtn").classList.toggle("hidden", !isHost);
});

socket.on("gameStarted", party => {
  // ðŸ”¥ THIS IS THE FIX ðŸ”¥
  document.getElementById("partyRoom").classList.add("hidden");
  document.getElementById("gameArea").classList.remove("hidden");

  document.getElementById("log").innerHTML +=
    `<div>Game started. Day ${party.day}</div>`;
});

socket.on("newPhase", data => {
  document.getElementById("phaseInfo").textContent =
    `Day ${data.day} â€“ ${data.phase.toUpperCase()}`;
});

socket.on("endOfDaySummary", s => {
  const log = document.getElementById("log");
  log.innerHTML += `<hr><div><b>Day ${s.day} Summary</b></div>`;
  s.deaths.forEach(d => log.innerHTML += `<div>${d}</div>`);
});
</script>

</body>
</html>
