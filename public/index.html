<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hunger Games Simulator</title>
</head>
<body>
    <h1>Hunger Games Simulator</h1>

    <!-- Party creation / join section -->
    <div id="party-section">
        <input type="text" id="party-password" placeholder="Party Password">
        <button id="create-party">Create Party</button>
        <input type="text" id="join-tribute" placeholder="Tribute Name">
        <button id="join-party">Join Party</button>
        <p id="party-message"></p>
        <p id="players-list"></p>

        <h3>Available Tributes:</h3>
        <ul id="tribute-list"></ul>

        <button id="start-game" disabled>Start Game</button>
    </div>

    <!-- Combat options -->
    <div id="combat-options" style="display:none;">
        <p id="combat-message"></p>
        <select id="target-select"></select>
        <button id="attack-btn">Attack</button>
        <button id="defend-btn">Defend</button>
        <button id="submit-action">Submit Action</button>
        <button id="reset-game">Reset Game</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        const partySection = document.getElementById('party-section');
        const combatDiv = document.getElementById('combat-options');

        const partyPasswordInput = document.getElementById('party-password');
        const joinTributeInput = document.getElementById('join-tribute');
        const createPartyBtn = document.getElementById('create-party');
        const joinPartyBtn = document.getElementById('join-party');
        const startGameBtn = document.getElementById('start-game');
        const resetGameBtn = document.getElementById('reset-game');
        const partyMessage = document.getElementById('party-message');
        const playersList = document.getElementById('players-list');
        const tributeList = document.getElementById('tribute-list');

        const combatMessage = document.getElementById('combat-message');
        const targetSelect = document.getElementById('target-select');
        const attackBtn = document.getElementById('attack-btn');
        const defendBtn = document.getElementById('defend-btn');
        const submitAction = document.getElementById('submit-action');

        let currentParty = '';
        let isHost = false;
        let selectedAction = null;
        let selectedTarget = null;

        // --- Party events ---
        createPartyBtn.onclick = () => {
            const password = partyPasswordInput.value.trim();
            if (!password) return alert('Enter a password.');
            socket.emit('createParty', password);
        };

        joinPartyBtn.onclick = () => {
            const password = partyPasswordInput.value.trim();
            const tributeName = joinTributeInput.value.trim();
            if (!password || !tributeName) return alert('Enter password and tribute name.');
            currentParty = password;
            socket.emit('joinParty', { password, tributeName });
        };

        startGameBtn.onclick = () => {
            socket.emit('startGame', currentParty);
        };

        resetGameBtn.onclick = () => {
            socket.emit('resetParty', currentParty);
        };

        // --- Combat events ---
        attackBtn.onclick = () => selectedAction = 'attack';
        defendBtn.onclick = () => selectedAction = 'defend';
        submitAction.onclick = () => {
            selectedTarget = targetSelect.value;
            if (!selectedAction) return alert('Choose an action!');
            socket.emit('playerAction', { password: currentParty, action: selectedAction, targetName: selectedTarget });
            selectedAction = null;
            combatDiv.style.display = 'none';
        };

        // --- Socket listeners ---
        socket.on('partyCreated', (password) => {
            currentParty = password;
            isHost = true;
            startGameBtn.disabled = false;
            partyMessage.textContent = `Party created: ${password}. You are the host.`;
        });

        socket.on('joinedParty', ({ password, tributeName, host }) => {
            currentParty = password;
            isHost = host;
            startGameBtn.disabled = !host;
            partyMessage.textContent = `Joined party: ${password} as ${tributeName}`;
        });

        socket.on('updatePlayers', (players) => {
            playersList.textContent = 'Players in party: ' + players.join(', ');
        });

        socket.on('updateAvailableTributes', (tributes) => {
            tributeList.innerHTML = '';
            tributes.forEach(t => {
                const li = document.createElement('li');
                li.textContent = `${t.name} ${t.taken ? '(Taken)' : ''}`;
                tributeList.appendChild(li);
            });
        });

        socket.on('partyError', (msg) => {
            partyMessage.textContent = msg;
        });

        socket.on('gameStarted', () => {
            partyMessage.textContent = 'Game started!';
            partySection.style.display = 'none';
            combatDiv.style.display = 'block';
        });

        socket.on('combatUpdate', (messages) => {
            combatMessage.textContent = messages.join('\n');
        });

        socket.on('yourTurn', ({ tributeName, targets }) => {
            combatDiv.style.display = 'block';
            combatMessage.textContent = `It's your turn: ${tributeName}`;
            targetSelect.innerHTML = '';
            targets.forEach(t => {
                const option = document.createElement('option');
                option.value = t;
                option.textContent = t;
                targetSelect.appendChild(option);
            });
        });

        socket.on('gameOver', (winner) => {
            combatMessage.textContent = `Game over! Winner: ${winner}`;
            combatDiv.style.display = 'none';
            partySection.style.display = 'block';
        });

        socket.on('partyReset', () => {
            combatDiv.style.display = 'none';
            partySection.style.display = 'block';
            partyMessage.textContent = 'Tributes reset! You can create or join a party again.';
            playersList.textContent = '';
            tributeList.innerHTML = '';
        });
    </script>
</body>
</html>
